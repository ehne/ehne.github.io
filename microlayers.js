// MICROLAYERS v1.1.0  - (c) ehne
class MicroLayers{constructor(t,e=300){this.baseTitle=t,this.topLayer=0,this.isLoading=!1,this.openLayers={},this.animationDuration=e,this.supported=!!(window.history.pushState&&window.requestAnimationFrame&&window.addEventListener&&window.fetch&&window.dispatchEvent)}start(){this.supported?(console.log("MicroLayers started"),addEventListener("click",this.clickCaptured,!0),addEventListener("popstate",this.popstateCaptured,!0)):console.log("MicroLayers not supported")}isClickSignificant(t){return!(t.target&&t.target.isContentEditable||t.defaultPrevented||t.which>1||t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)}clickCaptured=t=>{if(this.isLoading&&t.preventDefault(),this.isClickSignificant(t)&&t.target.href&&!this.isLoading){if(this.openLayers[t.target.dataset.openlayer])return void t.preventDefault();if(t.target.dataset.openlayer){t.preventDefault(),this.openLayers[t.target.dataset.openlayer]=!0,this.topLayer+=1,history.pushState({openLayers:this.openLayers,topLayer:this.topLayer},"",t.target.href),this.isLoading=!0,this.toggleLoadingIndicator(t.target);this.fetchpage(t.target.href).then((async e=>{const a=await e.text();this.isLoading=!1,this.toggleLoadingIndicator(t.target);const{title:i,layer:s}=this.getLayer(a,t.target.dataset.openlayer);s.setAttribute("ml-state","opened"),document.body.appendChild(s),this.openLayers[t.target.dataset.openlayer]=document.title,document.title=i}))}if(t.target.dataset.closelayer){t.preventDefault();const e=document.querySelector(`[data-microlayer="${t.target.dataset.closelayer}"]`);e.setAttribute("ml-state","closing"),this.getAnimationPromise().then((()=>{e.remove(),this.openLayers[t.target.dataset.closelayer]?document.title=this.openLayers[t.target.dataset.closelayer]:document.title=this.baseTitle,this.openLayers[t.target.dataset.closelayer]=!1,this.topLayer-=1,history.pushState({openLayers:this.openLayers,topLayer:this.topLayer},"",t.target.href),e.setAttribute("ml-state","closed")}))}}};popstateCaptured=t=>{console.log(t),window.location=t.target.location};getLayer=(t,e)=>{const a=document.createElement("html");a.innerHTML=t;return{layer:a.querySelector(`[data-microlayer="${e}"]`),title:a.querySelector("title").text}};toggleLoadingIndicator(t){"loading"===t.getAttribute("ml-state")?t.setAttribute("ml-state","loaded"):t.setAttribute("ml-state","loading")}fetchpage=t=>new Promise(((e,a)=>{fetch(t,{headers:{"X-Requested-With":"ML",Accept:"text/html, application/xhtml+xml"},method:"GET"}).then((i=>{500!==i.status?(dispatchEvent(new Event("pageLoaded")),e(i)):a(t)}))}));getAnimationPromise=()=>new Promise((t=>{setTimeout((()=>{t()}),this.animationDuration+1)}))}