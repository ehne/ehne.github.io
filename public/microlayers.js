// MICROLAYERS v1.0.0  - (c) ehne
class MicroLayers{constructor(t=300){this.currId=0,this.isLoading=!1,this.openLayers={},this.animationDuration=t,this.supported=!!(window.history.pushState&&window.requestAnimationFrame&&window.addEventListener&&window.fetch&&window.dispatchEvent)}start(){this.supported?(console.log("MicroLayers started"),addEventListener("click",this.clickCaptured,!0)):console.log("MicroLayers not supported")}isClickSignificant(t){return!(t.target&&t.target.isContentEditable||t.defaultPrevented||t.which>1||t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)}clickCaptured=t=>{if(this.isLoading&&t.preventDefault(),this.isClickSignificant(t)&&t.target.href&&!this.isLoading){if(this.openLayers[t.target.dataset.openlayer])return void t.preventDefault();if(t.target.dataset.openlayer){t.preventDefault(),history.pushState({microLayerId:this.currId},"",t.target.href),this.currId+=1,this.openLayers[t.target.dataset.openlayer]=!0,this.isLoading=!0,this.toggleLoadingIndicator(t.target);this.fetchpage(t.target.href).then((async e=>{const a=await e.text();this.isLoading=!1,this.toggleLoadingIndicator(t.target);const i=this.getLayer(a,t.target.dataset.openlayer);i.setAttribute("ml-state","opened"),document.body.appendChild(i)}))}if(t.target.dataset.closelayer){t.preventDefault();const e=document.querySelector(`[data-microlayer="${t.target.dataset.closelayer}"]`);e.setAttribute("ml-state","closing"),this.getAnimationPromise().then((()=>{e.remove(),this.openLayers[t.target.dataset.closelayer]=!1,console.log(this.openLayers),history.pushState({microLayerId:this.currId},"",t.target.href),this.currId+=1,e.setAttribute("ml-state","closed")}))}}};getLayer=(t,e)=>{const a=document.createElement("html");a.innerHTML=t;return a.querySelector(`[data-microlayer="${e}"]`)};toggleLoadingIndicator(t){"loading"===t.getAttribute("ml-state")?t.setAttribute("ml-state","loaded"):t.setAttribute("ml-state","loading")}fetchpage=t=>new Promise(((e,a)=>{fetch(t,{headers:{"X-Requested-With":"ML",Accept:"text/html, application/xhtml+xml"},method:"GET"}).then((i=>{500!==i.status?(dispatchEvent(new Event("pageLoaded")),e(i)):a(t)}))}));getAnimationPromise=()=>new Promise((t=>{setTimeout((()=>{t()}),this.animationDuration+1)}))}